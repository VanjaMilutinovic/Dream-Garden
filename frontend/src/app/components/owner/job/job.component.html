<div class="container">
    <h2>Trenutni poslovi</h2>
    <p class="error-message" *ngIf="currentJobs.length==0">Nema Neobrađenih Poslova</p>
    <table class="table table-striped" *ngIf="currentJobs.length>0">
        <thead>
        <tr>
            <th>Datum Zakazivanja</th>
            <th>Datum Početka</th>
            <th>Firma</th>
            <th>Usluge</th>
            <th>Canvas</th>
            <th><!--Cancel--></th>
        </tr>
        </thead>
        <tbody>
            <tr *ngFor="let job of currentJobs">
                <td>{{ job.requestDateTime | date:'dd-MM-yyyy hh:mm a' }}</td>
                <td>{{ job.startDateTime | date:'dd-MM-yyyy hh:mm a' }}</td>
                <td>{{ job.companyId.name }}</td>
                <td><ul>
                      <li *ngFor="let service of job.services">{{ service.serviceName }}</li>
                </ul></td>
                <td>
                    <button *ngIf="job.canvas" class="btn btn-primary" (click)="showCanvas(job.canvas)">Prikaži Canvas</button>
                </td>
                <td>
                    <button class="btn btn-secondary m-1 mb-0 mt-0" *ngIf="isCancelable(job.startDateTime)" 
                        (click)="cancel(job)">Otkaži</button>     
                </td>
            </tr>
        </tbody>
    </table>
    <app-canvas *ngIf="selectedCanvas" [existing]="selectedCanvas"></app-canvas>
</div>
<div class="container mb-5">
    <h2>Završeni poslovi</h2>
    <p class="error-message" *ngIf="finishedJobs.length==0">Nema Prihvaćenih Poslova</p>
    <table class="table table-striped" *ngIf="finishedJobs.length>0">
        <thead>
        <tr>
            <th>Datum Završetka</th>
            <th>Firma</th>
            <th>Recenzija</th>
        </tr>
        </thead>
        <tbody>
            <tr *ngFor="let job of finishedJobs">
                <td>{{ job.endDateTime | date:'dd-MM-yyyy hh:mm a' }}</td>
                <td>{{ job.companyId.name }}</td>
                <td>
                    <div *ngIf="job.jobReview">{{ job.jobReview.comment }} {{ job.jobReview.grade }}</div>
                    <div *ngIf="!job.jobReview && !showPopup">
                        <button class="btn btn-primary"  (click)="openPopup(job.jobId)">
                            Dodaj recenziju
                        </button>
                    </div>
                    <div *ngIf="showPopup && selectedJobId==job.jobId" class="popup col-md-4">
                    <div class="popup-content">
                        <p><strong>ID: {{ selectedJobId }}</strong></p>
                        <input id="comment" type="text" [(ngModel)]="reviewComment" 
                        name="comment" class="form-control" required placeholder="Komentar">
                        <input id="grade" type="number" min="1" max="5" [(ngModel)]="reviewGrade" 
                            name="grade" class="form-control mt-2" required placeholder="Ocena">
                        <button class="btn btn-primary mt-2" (click)="submitReview(job)">Oceni</button>
                        <button class="btn btn-secondary mt-2" (click)="closePopup()">Cancel</button>
                    </div>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>